<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>chkptstanr • chkptstanr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="chkptstanr">
<meta property="og:description" content="Fit Bayesian models in Stan &lt;doi: 10.18637/jss.v076.i01&gt; 
  with checkpointing, that is, the ability to stop the MCMC sampler at 
  will, and then pick right back up where the MCMC sampler left off. 
  Custom Stan models can be fitted, or the popular package brms 
  &lt;doi: 10.18637/jss.v080.i01&gt; can be used to generate the Stan code. This 
  package is fully compatible with the R packages brms, posterior, cmdstanr, 
  and bayesplot. ">
<meta property="og:image" content="https://venpopov.github.io/chkptstanr/reference/figures/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">chkptstanr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Functions</a>
</li>
<li>
  <a href="articles/index.html">Articles</a>
</li>
<li>
  <a href="news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/venpopov/chkptstanr/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div class="section level1">
<div class="page-header"><h1 id="checkpoint-mcmc-sampling-with-stan">Checkpoint MCMC Sampling with Stan<a class="anchor" aria-label="anchor" href="#checkpoint-mcmc-sampling-with-stan"></a>
</h1></div>
<p>Fit Bayesian models in <strong>Stan</strong> (Carpenter et al. 2017) with checkpointing, that is, the ability to stop the HMC sampler at will, and then pick right back up where the sampler left off. Custom <strong>Stan</strong> models can be fitted, or the popular package <strong>brms</strong> (Bürkner 2017) can be used to generate the <strong>Stan</strong> code. This package is fully compatible with the <code>R</code> packages <a href="http://paul-buerkner.github.io/brms/" class="external-link"><strong>brms</strong></a>, <a href="https://mc-stan.org/posterior/" class="external-link"><strong>posterior</strong></a>, <a href="https://mc-stan.org/cmdstanr/" class="external-link"><strong>cmdstanr</strong></a>, and <a href="https://mc-stan.org/bayesplot/" class="external-link"><strong>bayesplot</strong></a>.</p>
<p>There are a variety of use cases for <strong>chkptstanr</strong>, including (but not limited to) the following:</p>
<ul>
<li>
<p>The primary motivation for developing <strong>chkptstanr</strong> is to reduce the cost of fitting models with <strong>Stan</strong> when using, say, AWS, and in particular by taking advantage of so-called <em>spot instances</em>. These instances are “a cost-effective choice if you can be flexible about when your applications run and if your applications can be <em>interrupted</em> [emphasis added]” <a href="(https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-spot-instances.html)" class="external-link">AWS website</a>.</p>
<p><strong>chkptstanr</strong> thus allows for taking advantage of spot instances by enabling “interruptions” during model fitting. This can reduce the cost by 90 %.</p>
</li>
<li>
<p><strong>Stan</strong> allows for fitting complex models. This often entails iteratively improving the model to ensure that the MCMC algorithm has converged. Typically this requires waiting until the model has <em>finished sampling</em>, and then assessing MCMC diagnostics (e.g., R-hat).</p>
<p><strong>chkptstanr</strong> can be used to make iterative model building more<br>
efficient, e.g., by having the ability to pause sampling and examine the model (e.g., convergence diagnostics), and then deciding to stop sampling or to continue on.</p>
</li>
<li>
<p>Computationally intensive models can sometimes take several days to finish up. When using a personal computer, this can take up all the computing resources.</p>
<p><strong>chkptstanr</strong> can be used with scheduling, such that the model is fitted during certain windows (e.g., at night, weekends, etc.)</p>
</li>
<li>
<p>Those familiar with Bayesian methods will know all too well that a model can take longer than expected. This can be problematic when there is another task that needs to be completed, because one is faced with waiting it out or stopping the model (and loosing all of the progress).</p>
<p><strong>chkptstanr</strong> makes it so that models can be conveniently stopped if need be, while not loosing any of the progress.</p>
</li>
</ul>
<div class="section level2">
<h2 id="about-this-fork">About this fork<a class="anchor" aria-label="anchor" href="#about-this-fork"></a>
</h2>
<p>The original package was developed by <a href="https://github.com/donaldRwilliams/chkptstanr" class="external-link">Donald R. Williams</a>. However, the package has not been updated in 2 years, despite breaking issues. Donald has kindly agreed for me to take over the package maintenance and development.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>The current CRAN version (0.1.1) has several bugs, and until the next release, you can install the development version from GitHub:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"venpopov/chkptstanr"</span><span class="op">)</span></span></code></pre></div>
<p>These packages are needed.</p>
</div>
<div class="section level2">
<h2 id="packages">Packages<a class="anchor" aria-label="anchor" href="#packages"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/venpopov/chkptstanr" class="external-link">chkptstanr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/paul-buerkner/brms" class="external-link">brms</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/lme4/lme4/" class="external-link">lme4</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="how-to-use-chkptstanr">How to use chkptstanr<a class="anchor" aria-label="anchor" href="#how-to-use-chkptstanr"></a>
</h2>
<p>The primary use of <strong>chkptstanr</strong> is to sample from the posterior distribution, while having the option of starting and stopping the sampler at will. Currently you have two options:</p>
<ul>
<li>Manually abort the sampling process at any point</li>
<li>Predetermine the stopping point by specifying the number of iterations after which to stop the sampler via the <code>stop_after</code> argument</li>
</ul>
<div class="section level3">
<h3 id="example-1-manual-abort">Example 1: Manual abort<a class="anchor" aria-label="anchor" href="#example-1-manual-abort"></a>
</h3>
<p>To make this clear, we will run the main example from the <code>brms</code> (webpage)[<a href="https://paul-buerkner.github.io/brms/#how-to-use-brms" class="external-link uri">https://paul-buerkner.github.io/brms/#how-to-use-brms</a>]. The only additional arguments here are <code>path</code>, the location of the folder in which to store intermediate samples, and <code>iter_per_chkpt</code>, the number of iterations between each checkpoint. After the model sampled for 1200 iterations, we <em>manually</em> abort it:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit1</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/chkpt_brms.html">chkpt_brms</a></span><span class="op">(</span><span class="va">count</span> <span class="op">~</span> <span class="va">zAge</span> <span class="op">+</span> <span class="va">zBase</span> <span class="op">*</span> <span class="va">Trt</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">patient</span><span class="op">)</span>,</span>
<span>                   data <span class="op">=</span> <span class="va">epilepsy</span>, </span>
<span>                   family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">poisson</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                   iter_per_chkpt <span class="op">=</span> <span class="fl">200</span>,</span>
<span>                   path <span class="op">=</span> <span class="st">'checkpoints/epilepsy'</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">#&gt; Compiling Stan program...</span></span>
<span><span class="co">#&gt; Initial Warmup (Typical Set)</span></span>
<span><span class="co">#&gt; Chkpt: 1 / 10; Iteration: 200 / 2000 (warmup)</span></span>
<span><span class="co">#&gt; Chkpt: 2 / 10; Iteration: 400 / 2000 (warmup)</span></span>
<span><span class="co">#&gt; Chkpt: 3 / 10; Iteration: 600 / 2000 (warmup)</span></span>
<span><span class="co">#&gt; Chkpt: 4 / 10; Iteration: 800 / 2000 (warmup)</span></span>
<span><span class="co">#&gt; Chkpt: 5 / 10; Iteration: 1000 / 2000 (warmup)</span></span>
<span><span class="co">#&gt; Chkpt: 6 / 10; Iteration: 1200 / 2000 (sample)</span></span>
<span><span class="co">#&gt; Sampling aborted. You can examine the results or continue sampling by rerunning the same code.</span></span></code></pre></div>
<p>If the sampler is passed the warmup stage, it returns a <code>brmsfit</code> object, so you can examine the results:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit1</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a> Family<span class="sc">:</span> poisson </span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>  Links<span class="sc">:</span> mu <span class="ot">=</span> log </span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>Formula<span class="sc">:</span> count <span class="sc">~</span> zAge <span class="sc">+</span> zBase <span class="sc">*</span> Trt <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> patient) </span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>   Data<span class="sc">:</span> <span class="fu">data</span> (Number of observations<span class="sc">:</span> <span class="dv">236</span>) </span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>  Draws<span class="sc">:</span> <span class="dv">4</span> chains, each with iter <span class="ot">=</span> <span class="dv">1200</span>; warmup <span class="ot">=</span> <span class="dv">1000</span>; thin <span class="ot">=</span> <span class="dv">1</span>;</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>         total post<span class="sc">-</span>warmup draws <span class="ot">=</span> <span class="dv">800</span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>Multilevel Hyperparameters<span class="sc">:</span></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a><span class="er">~</span><span class="fu">patient</span> (Number of levels<span class="sc">:</span> <span class="dv">59</span>) </span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>              Estimate Est.Error l<span class="dv">-95</span><span class="sc">% CI u-95%</span> CI Rhat Bulk_ESS Tail_ESS</span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a><span class="fu">sd</span>(Intercept)     <span class="fl">0.57</span>      <span class="fl">0.07</span>     <span class="fl">0.45</span>     <span class="fl">0.72</span> <span class="fl">1.02</span>      <span class="dv">209</span>      <span class="dv">236</span></span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a>Regression Coefficients<span class="sc">:</span></span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a>           Estimate Est.Error l<span class="dv">-95</span><span class="sc">% CI u-95%</span> CI Rhat Bulk_ESS Tail_ESS</span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a>Intercept      <span class="fl">1.75</span>      <span class="fl">0.11</span>     <span class="fl">1.52</span>     <span class="fl">1.98</span> <span class="fl">1.02</span>      <span class="dv">206</span>      <span class="dv">371</span></span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a>zAge           <span class="fl">0.10</span>      <span class="fl">0.08</span>    <span class="sc">-</span><span class="fl">0.07</span>     <span class="fl">0.25</span> <span class="fl">1.02</span>      <span class="dv">240</span>      <span class="dv">443</span></span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a>zBase          <span class="fl">0.70</span>      <span class="fl">0.11</span>     <span class="fl">0.47</span>     <span class="fl">0.95</span> <span class="fl">1.00</span>      <span class="dv">220</span>      <span class="dv">370</span></span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a>Trt1          <span class="sc">-</span><span class="fl">0.24</span>      <span class="fl">0.16</span>    <span class="sc">-</span><span class="fl">0.56</span>     <span class="fl">0.07</span> <span class="fl">1.02</span>      <span class="dv">199</span>      <span class="dv">239</span></span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a>zBase<span class="sc">:</span>Trt1     <span class="fl">0.05</span>      <span class="fl">0.15</span>    <span class="sc">-</span><span class="fl">0.26</span>     <span class="fl">0.35</span> <span class="fl">1.00</span>      <span class="dv">243</span>      <span class="dv">350</span></span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a></span>
<span id="cb5-21"><a href="#cb5-21" tabindex="-1"></a>Draws were sampled using <span class="fu">sample</span>(hmc). For each parameter, Bulk_ESS</span>
<span id="cb5-22"><a href="#cb5-22" tabindex="-1"></a>and Tail_ESS are effective sample size measures, and Rhat is the potential</span>
<span id="cb5-23"><a href="#cb5-23" tabindex="-1"></a>scale reduction factor on split <span class="fu">chains</span> (at convergence, <span class="at">Rhat =</span> <span class="dv">1</span>).</span></code></pre></div>
<p>We see that the model has not converged, and we can continue sampling by rerunning the same code.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit1</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/chkpt_brms.html">chkpt_brms</a></span><span class="op">(</span><span class="va">count</span> <span class="op">~</span> <span class="va">zAge</span> <span class="op">+</span> <span class="va">zBase</span> <span class="op">*</span> <span class="va">Trt</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">patient</span><span class="op">)</span>,</span>
<span>                   data <span class="op">=</span> <span class="va">epilepsy</span>, </span>
<span>                   family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">poisson</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                   iter_per_chkpt <span class="op">=</span> <span class="fl">200</span>,</span>
<span>                   path <span class="op">=</span> <span class="st">'checkpoints/epilepsy'</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#&gt; Model executable is up to date!</span></span>
<span><span class="co">#&gt; Chkpt: 7 / 10; Iteration: 1400 / 2000 (sample)</span></span>
<span><span class="co">#&gt; Chkpt: 8 / 10; Iteration: 1600 / 2000 (sample)</span></span>
<span><span class="co">#&gt; Chkpt: 9 / 10; Iteration: 1800 / 2000 (sample)</span></span>
<span><span class="co">#&gt; Chkpt: 10 / 10; Iteration: 2000 / 2000 (sample)</span></span>
<span><span class="co">#&gt; Checkpointing complete</span></span></code></pre></div>
<p>And examine the final results:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit1</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>Family<span class="sc">:</span> poisson </span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>  Links<span class="sc">:</span> mu <span class="ot">=</span> log </span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>Formula<span class="sc">:</span> count <span class="sc">~</span> zAge <span class="sc">+</span> zBase <span class="sc">*</span> Trt <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> patient) </span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>   Data<span class="sc">:</span> <span class="fu">data</span> (Number of observations<span class="sc">:</span> <span class="dv">236</span>) </span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>  Draws<span class="sc">:</span> <span class="dv">4</span> chains, each with iter <span class="ot">=</span> <span class="dv">2000</span>; warmup <span class="ot">=</span> <span class="dv">1000</span>; thin <span class="ot">=</span> <span class="dv">1</span>;</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>         total post<span class="sc">-</span>warmup draws <span class="ot">=</span> <span class="dv">4000</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>Multilevel Hyperparameters<span class="sc">:</span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a><span class="er">~</span><span class="fu">patient</span> (Number of levels<span class="sc">:</span> <span class="dv">59</span>) </span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a>              Estimate Est.Error l<span class="dv">-95</span><span class="sc">% CI u-95%</span> CI Rhat Bulk_ESS Tail_ESS</span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a><span class="fu">sd</span>(Intercept)     <span class="fl">0.58</span>      <span class="fl">0.07</span>     <span class="fl">0.45</span>     <span class="fl">0.73</span> <span class="fl">1.00</span>      <span class="dv">956</span>     <span class="dv">1696</span></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a>Regression Coefficients<span class="sc">:</span></span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a>           Estimate Est.Error l<span class="dv">-95</span><span class="sc">% CI u-95%</span> CI Rhat Bulk_ESS Tail_ESS</span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a>Intercept      <span class="fl">1.77</span>      <span class="fl">0.12</span>     <span class="fl">1.53</span>     <span class="fl">2.00</span> <span class="fl">1.00</span>      <span class="dv">887</span>     <span class="dv">1575</span></span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a>zAge           <span class="fl">0.10</span>      <span class="fl">0.09</span>    <span class="sc">-</span><span class="fl">0.07</span>     <span class="fl">0.26</span> <span class="fl">1.00</span>      <span class="dv">871</span>     <span class="dv">1256</span></span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a>zBase          <span class="fl">0.70</span>      <span class="fl">0.12</span>     <span class="fl">0.47</span>     <span class="fl">0.94</span> <span class="fl">1.00</span>      <span class="dv">986</span>     <span class="dv">1675</span></span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a>Trt1          <span class="sc">-</span><span class="fl">0.26</span>      <span class="fl">0.16</span>    <span class="sc">-</span><span class="fl">0.60</span>     <span class="fl">0.05</span> <span class="fl">1.01</span>      <span class="dv">987</span>     <span class="dv">1170</span></span>
<span id="cb8-19"><a href="#cb8-19" tabindex="-1"></a>zBase<span class="sc">:</span>Trt1     <span class="fl">0.05</span>      <span class="fl">0.16</span>    <span class="sc">-</span><span class="fl">0.26</span>     <span class="fl">0.37</span> <span class="fl">1.00</span>     <span class="dv">1075</span>     <span class="dv">1824</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="predetermine-stopping-point">Predetermine stopping point<a class="anchor" aria-label="anchor" href="#predetermine-stopping-point"></a>
</h3>
<p>In addition to manually aborting the run, we can predetermine the stopping point by specifying the number of iterations after which to stop the sampler via the <code>stop_after</code> argument.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit1</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/chkpt_brms.html">chkpt_brms</a></span><span class="op">(</span><span class="va">count</span> <span class="op">~</span> <span class="va">zAge</span> <span class="op">+</span> <span class="va">zBase</span> <span class="op">*</span> <span class="va">Trt</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">patient</span><span class="op">)</span>,</span>
<span>                   data <span class="op">=</span> <span class="va">epilepsy</span>, </span>
<span>                   family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">poisson</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                   iter_per_chkpt <span class="op">=</span> <span class="fl">200</span>,</span>
<span>                   stop_after <span class="op">=</span> <span class="fl">1400</span>,</span>
<span>                   path <span class="op">=</span> <span class="st">'checkpoints/epilepsy'</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">#&gt; Compiling Stan program...</span></span>
<span><span class="co">#&gt; Initial Warmup (Typical Set)</span></span>
<span><span class="co">#&gt; Chkpt: 1 / 10; Iteration: 200 / 2000 (warmup)</span></span>
<span><span class="co">#&gt; Chkpt: 2 / 10; Iteration: 400 / 2000 (warmup)</span></span>
<span><span class="co">#&gt; Chkpt: 3 / 10; Iteration: 600 / 2000 (warmup)</span></span>
<span><span class="co">#&gt; Chkpt: 4 / 10; Iteration: 800 / 2000 (warmup)</span></span>
<span><span class="co">#&gt; Chkpt: 5 / 10; Iteration: 1000 / 2000 (warmup)</span></span>
<span><span class="co">#&gt; Chkpt: 6 / 10; Iteration: 1200 / 2000 (sample)</span></span>
<span><span class="co">#&gt; Chkpt: 7 / 10; Iteration: 1400 / 2000 (sample)</span></span>
<span><span class="co">#&gt; Sampling aborted. You can examine the results or continue sampling by rerunning the same code.</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="reset-sampling">Reset sampling<a class="anchor" aria-label="anchor" href="#reset-sampling"></a>
</h3>
<p>If we want to reset the sampling, we can use the <code>reset</code> argument, as long as we have not changed any of the key arguments. For example, we can reset the sampling and start from scratch, but we cannot change the formula, data, or family (but we can change “stop_after”)</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit1</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/chkpt_brms.html">chkpt_brms</a></span><span class="op">(</span><span class="va">count</span> <span class="op">~</span> <span class="va">zAge</span> <span class="op">+</span> <span class="va">zBase</span> <span class="op">*</span> <span class="va">Trt</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">patient</span><span class="op">)</span>,</span>
<span>                   data <span class="op">=</span> <span class="va">epilepsy</span>, </span>
<span>                   family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">poisson</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                   iter_per_chkpt <span class="op">=</span> <span class="fl">200</span>,</span>
<span>                   path <span class="op">=</span> <span class="st">'checkpoints/epilepsy'</span>,</span>
<span>                   stop_after <span class="op">=</span> <span class="fl">1600</span>,</span>
<span>                   reset <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>If we try to change the formula, data, or family, we will get an error:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit1</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/chkpt_brms.html">chkpt_brms</a></span><span class="op">(</span><span class="va">count</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">patient</span><span class="op">)</span>,</span>
<span>                   data <span class="op">=</span> <span class="va">epilepsy</span>, </span>
<span>                   family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">poisson</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                   iter_per_chkpt <span class="op">=</span> <span class="fl">200</span>,</span>
<span>                   path <span class="op">=</span> <span class="st">'checkpoints/epilepsy'</span>,</span>
<span>                   stop_after <span class="op">=</span> <span class="fl">1600</span>,</span>
<span>                   reset <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>Error<span class="sc">:</span> Important arguments have been changed. Please completely reset the checkpointing via <span class="fu">reset_checkpoints</span>(path, <span class="at">recompile =</span> <span class="cn">TRUE</span>).</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>Interupted before or during warmup. No samples available.</span></code></pre></div>
<p>This is because we cannot use the existing compiled model. We need to reset the checkpoints and recompile the model:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/reset_checkpoints.html">reset_checkpoints</a></span><span class="op">(</span><span class="st">'checkpoints/epilepsy'</span>, recompile <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Bürkner P (2017). “brms: An R package for Bayesian multilevel models using Stan.” Journal of statistical software, 80, 1–28.</p>
<p>Carpenter B, Gelman A, Hoffman MD, Lee D, Goodrich B, Betancourt M, Brubaker M, Guo J, Li P, Riddell A (2017). “Stan: A probabilistic programming language.” Journal of statistical software, 76(1).</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=chkptstanr" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/venpopov/chkptstanr/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/venpopov/chkptstanr/issues" class="external-link">Report a bug</a></li>
<li><a href="https://github.com/donaldRwilliams/chkptstanr" class="external-link">Ask a question about chkptstanr</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small>Apache License 2.0 | file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing chkptstanr</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Vencislav Popov <br><small class="roles"> Author, maintainer, copyright holder </small>  </li>
<li>Donald Williams <br><small class="roles"> Author </small>  </li>
<li>Tyler Matta <br><small class="roles"> Author </small>  </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>



  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by Vencislav Popov, Donald Williams, Tyler Matta.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
